on: [push, pull_request]
jobs:
  deutschland_generation:
    name: "Deutschland Generation"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      # Runs a single command using the runners shell
      - name: "Lint file"
        uses: stoplightio/spectral-action@v0.8.1
        with:
            file_glob: "openapi.yaml"

      - name: "Generate deutschland code"
        uses: wirthual/deutschland-generator-action@v0.2.3
        with:
          version: 1.0.3
          package-name: "autobahn"
          openapi-file: ${{ github.workspace }}/openapi.yaml
          upload-to-pypi: false
          use-testpypi: true
          pypi-token: ${{ secrets.TEST_PYPI_API_TOKEN }}